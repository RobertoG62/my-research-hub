<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Deep Research Hub | 专 注</title>
    <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        body { font-family: 'Rubik', sans-serif; background: radial-gradient(at top left, #e0f2fe 0%, #f0f9ff 100%); min-height: 100vh; color: #1e293b; }
        .glass-card { background: rgba(255, 255, 255, 0.75); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.5); box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.1); transition: all 0.3s ease; }
        .glass-card:hover { transform: translateY(-2px); box-shadow: 0 12px 40px 0 rgba(31, 38, 135, 0.15); }
        .btn-primary { background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%); transition: all 0.3s ease; }
        .btn-primary:hover { transform: scale(1.02); box-shadow: 0 4px 15px rgba(37, 99, 235, 0.3); }
        .fa-arrow-left { transform: rotate(180deg); }
        .loader { border: 3px solid #f3f3f3; border-radius: 50%; border-top: 3px solid #3498db; width: 20px; height: 20px; animation: spin 1s linear infinite; display: none; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        /* 驻住  注爪 */
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background-color: rgba(156, 163, 175, 0.5); border-radius: 20px; }
    </style>
</head>
<body class="p-4 md:p-8">

    <header class="max-w-7xl mx-auto mb-8 flex justify-between items-center bg-white/60 p-4 rounded-2xl shadow-sm backdrop-blur-md">
        <div class="flex items-center gap-3">
            <div class="inline-flex items-center justify-center p-2 bg-blue-100 rounded-full">
                <i class="fas fa-shield-alt text-blue-600 text-xl"></i>
            </div>
            <div>
                <h1 class="text-xl font-bold text-slate-800">Deep Research Hub</h1>
                <p class="text-xs text-slate-500">Secure & Connected V2.0</p>
            </div>
        </div>
        
        <div id="authSection">
            <button id="loginBtn" onclick="window.googleLogin()" class="bg-white border border-gray-300 text-gray-700 hover:bg-gray-50 font-medium py-2 px-4 rounded-lg flex items-center gap-2 transition shadow-sm">
                <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" class="w-5 h-5">
                <span>转专 注 Google</span>
            </button>
            <div id="userDisplay" class="hidden flex items-center gap-3">
                <span id="userName" class="text-sm font-medium"></span>
                <img id="userPhoto" src="" class="w-8 h-8 rounded-full border border-gray-200">
                <button onclick="window.logout()" class="text-xs text-red-500 hover:text-red-700 underline">转转拽</button>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto grid grid-cols-1 lg:grid-cols-12 gap-8">
        
        <section class="lg:col-span-3 order-2 lg:order-1">
            <div class="glass-card rounded-2xl p-5 h-[calc(100vh-150px)] flex flex-col">
                <h3 class="font-bold text-gray-700 mb-4 flex items-center gap-2">
                    <i class="fas fa-history text-blue-500"></i> 住专转 拽专
                </h3>
                <div id="historyList" class="flex-1 overflow-y-auto space-y-2 pr-1 custom-scrollbar">
                    <p class="text-sm text-gray-400 text-center mt-10">转专  专转 住专</p>
                </div>
            </div>
        </section>

        <section class="lg:col-span-6 space-y-6 order-1 lg:order-2">
            <div class="glass-card rounded-2xl p-6 relative">
                <h2 class="text-xl font-bold mb-4 flex items-center gap-2">
                    <i class="fas fa-search text-blue-600"></i> 砖 砖
                </h2>
                <textarea id="topicInput" rows="3" 
                    class="w-full p-4 rounded-xl border border-gray-200 focus:ring-2 focus:ring-blue-500 focus:outline-none resize-none bg-white/50"
                    placeholder=" 转专爪 拽专 ? (砖: 注转 专 专拽 -2030)"></textarea>
                
                <div class="flex justify-between items-center mt-4">
                    <div class="text-xs text-gray-500 flex items-center gap-1">
                        <i class="fas fa-lock"></i> 注 砖 驻专 
                    </div>
                    <button onclick="window.generateAndSave()" class="btn-primary text-white font-bold py-2 px-8 rounded-xl flex items-center gap-2 shadow-lg hover:shadow-xl">
                        <div class="loader" id="saveLoader"></div>
                        <span id="saveBtnText">爪专 砖专 注</span>
                        <i class="fas fa-magic"></i>
                    </button>
                </div>
            </div>

            <div class="glass-card rounded-2xl p-6">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="font-bold text-gray-700">驻专驻 </h2>
                    <button onclick="window.copyToClipboard()" class="text-blue-600 hover:text-blue-800 text-sm font-medium bg-blue-50 px-3 py-1 rounded-lg transition"><i class="far fa-copy"></i> 注转拽</button>
                </div>
                <textarea id="promptOutput" readonly 
                    class="w-full h-[300px] p-4 bg-white/40 rounded-xl border border-gray-200 font-mono text-sm leading-relaxed focus:outline-none resize-none"
                    placeholder="驻专驻 拽爪注 驻注 ..."></textarea>
            </div>
        </section>

        <section class="lg:col-span-3 order-3 lg:order-3">
             <div class="glass-card rounded-2xl p-5 sticky top-5">
                <h2 class="text-lg font-bold mb-4 flex items-center gap-2">
                    <i class="fas fa-rocket text-purple-600"></i> 砖专 专
                </h2>
                <div class="space-y-3">
                    <button onclick="window.openTool('https://gemini.google.com/app')" class="w-full flex items-center p-3 bg-white/60 rounded-xl hover:bg-blue-50 transition text-right group border border-transparent hover:border-blue-200">
                        <i class="fas fa-star text-blue-500 w-8"></i>
                        <span class="text-sm font-medium group-hover:text-blue-600">Gemini</span>
                    </button>
                    <button onclick="window.openTool('https://chatgpt.com/')" class="w-full flex items-center p-3 bg-white/60 rounded-xl hover:bg-green-50 transition text-right group border border-transparent hover:border-green-200">
                        <i class="fas fa-robot text-green-600 w-8"></i>
                        <span class="text-sm font-medium group-hover:text-green-600">ChatGPT</span>
                    </button>
                    <button onclick="window.openTool('https://claude.ai/new')" class="w-full flex items-center p-3 bg-white/60 rounded-xl hover:bg-orange-50 transition text-right group border border-transparent hover:border-orange-200">
                        <i class="fas fa-brain text-orange-600 w-8"></i>
                        <span class="text-sm font-medium group-hover:text-orange-600">Claude</span>
                    </button>
                    <button onclick="window.openTool('https://www.perplexity.ai/')" class="w-full flex items-center p-3 bg-white/60 rounded-xl hover:bg-teal-50 transition text-right group border border-transparent hover:border-teal-200">
                        <i class="fas fa-search-location text-teal-600 w-8"></i>
                        <span class="text-sm font-medium group-hover:text-teal-600">Perplexity</span>
                    </button>
                     <div class="h-px bg-gray-300 my-2"></div>
                     <button onclick="window.openTool('https://notebooklm.google.com/')" class="w-full flex items-center p-3 bg-yellow-50 rounded-xl hover:bg-yellow-100 transition text-right group border border-yellow-200 shadow-sm">
                        <i class="fas fa-book-open text-yellow-600 w-8"></i>
                        <span class="text-sm font-medium group-hover:text-yellow-700">NotebookLM (住)</span>
                    </button>
                     <button onclick="window.openAllTools()" class="w-full mt-2 py-2 text-xs text-indigo-600 hover:bg-indigo-50 rounded-lg border border-indigo-200 font-bold">
                         驻转 转  拽
                    </button>
                </div>
            </div>
        </section>

    </main>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, query, where, orderBy, onSnapshot } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        // ==========================================
        //   砖转  转 拽 转 砖砖转
        // ==========================================
        
        const firebaseConfig = {
            apiKey: "AIzaSyC9EbSoqlGUOn8_uy6XnEQLvx6_u47_5lQ",
            authDomain: "deepresearch-89379.firebaseapp.com",
            projectId: "deepresearch-89379",
            storageBucket: "deepresearch-89379.firebasestorage.app",
            messagingSenderId: "431172801604",
            appId: "1:431172801604:web:ec37a4b611c9ca71641811",
            measurementId: "G-3Z03QN5Y6W"
        };

        // ==========================================
        //    拽 砖 专
        // ==========================================

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        const provider = new GoogleAuthProvider();
        
        let currentUser = null;

        // 拽转 转专转
        window.googleLogin = () => {
            signInWithPopup(auth, provider)
                .then((result) => console.log("专:", result.user.email))
                .catch((error) => {
                    console.error(error);
                    alert("砖 转专转: " + error.message);
                });
        };

        window.logout = () => {
            signOut(auth).then(() => console.log("转拽"));
        };

        //  爪 砖转砖
        onAuthStateChanged(auth, (user) => {
            currentUser = user;
            const loginBtn = document.getElementById('loginBtn');
            const userDisplay = document.getElementById('userDisplay');

            if (user) {
                loginBtn.classList.add('hidden');
                userDisplay.classList.remove('hidden');
                document.getElementById('userName').textContent = user.displayName ? user.displayName.split(' ')[0] : '专';
                document.getElementById('userPhoto').src = user.photoURL || 'https://via.placeholder.com/40';
                loadHistory(); 
            } else {
                loginBtn.classList.remove('hidden');
                userDisplay.classList.add('hidden');
                document.getElementById('historyList').innerHTML = '<p class="text-sm text-gray-400 text-center mt-10">转专  专转 住专</p>';
            }
        });

        const promptTemplate = ` 专爪 砖转注专  转 驻专驻 拽爪注 砖驻砖 注 专 爪专  拽转,  住专转 砖驻砖专,  砖 砖转砖  驻爪壮专 - Deep Research.

专 砖   爪专 , 拽驻 转转 转专 转 砖  砖驻 砖 驻砖: 
>> {TOPIC} <<

转住住 注 专 砖爪转, 爪注 拽专 注拽 专  转专.
拽专 爪专 转:
- 住 爪专 拽爪注转 专专.
- 住住 注 拽专转  注 .
-   , 转 转, 转 转 驻 砖驻砖专.
- 注  砖转专  住 砖 砖专转 (, 专转,  ').

转砖 爪专 转 拽驻, 住专转 注 转专转,  住拽转 专专转.
住, 转 转砖专 驻砖专转 驻转 转爪注  拽专 住驻 砖 爪  专 注.`;

        window.generateAndSave = async () => {
            const topic = document.getElementById('topicInput').value;
            if (!topic.trim()) { alert('  砖'); return; }

            const finalPrompt = promptTemplate.replace('{TOPIC}', topic);
            document.getElementById('promptOutput').value = finalPrompt;

            if (currentUser) {
                const btnText = document.getElementById('saveBtnText');
                const loader = document.getElementById('saveLoader');
                btnText.textContent = "砖专...";
                loader.style.display = "inline-block";

                try {
                    await addDoc(collection(db, "researches"), {
                        uid: currentUser.uid,
                        topic: topic,
                        prompt: finalPrompt,
                        timestamp: new Date()
                    });
                } catch (e) {
                    console.error("Error: ", e);
                    alert("砖 砖专!  专转 爪专 Database -Firebase  砖拽 (Rules) 专 ?");
                } finally {
                    btnText.textContent = "爪专 砖专 注";
                    loader.style.display = "none";
                }
            } else {
                alert("砖 : 驻专驻 爪专,   砖专 住专   专.");
            }
        };

        function loadHistory() {
            if (!currentUser) return;
            
            const q = query(collection(db, "researches"), 
                          where("uid", "==", currentUser.uid), 
                          orderBy("timestamp", "desc"));

            onSnapshot(q, (querySnapshot) => {
                const list = document.getElementById('historyList');
                list.innerHTML = "";
                
                if(querySnapshot.empty) {
                    list.innerHTML = '<p class="text-sm text-gray-400 text-center mt-4"> 注 拽专 砖专</p>';
                    return;
                }

                querySnapshot.forEach((doc) => {
                    const data = doc.data();
                    const div = document.createElement('div');
                    div.className = "p-3 bg-white/50 rounded-lg hover:bg-blue-50 cursor-pointer transition border border-transparent hover:border-blue-200 text-sm mb-2 shadow-sm";
                    div.onclick = () => {
                        document.getElementById('topicInput').value = data.topic;
                        document.getElementById('promptOutput').value = data.prompt;
                    };
                    
                    const date = data.timestamp ? new Date(data.timestamp.seconds * 1000).toLocaleDateString('he-IL') : '';
                    
                    div.innerHTML = `
                        <div class="font-bold text-gray-800 truncate">${data.topic}</div>
                        <div class="text-xs text-gray-500 mt-1 flex justify-between">
                            <span>${date}</span>
                            <i class="fas fa-chevron-left text-xs opacity-50"></i>
                        </div>
                    `;
                    list.appendChild(div);
                });
            });
        }

        window.openTool = (url) => window.open(url, '_blank');
        
        window.openAllTools = () => {
            const urls = [
                'https://claude.ai/new', 
                'https://gemini.google.com/app', 
                'https://chatgpt.com/', 
                'https://www.genspark.ai/', 
                'https://www.perplexity.ai/'
            ];
            urls.forEach(url => window.open(url, '_blank'));
            window.open('https://docs.google.com/document/d/1DNu71a38Tusb4Vdiw7zZElelgt5pzRsmFiftIBYVyjA/edit?tab=t.0', '_blank');
        };

        window.copyToClipboard = () => {
            const outputText = document.getElementById('promptOutput');
            outputText.select();
            document.execCommand('copy');
            
            const btn = document.querySelector('button[onclick="window.copyToClipboard()"]');
            const originalText = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-check"></i> 注转拽!';
            btn.classList.add('bg-green-100', 'text-green-700');
            setTimeout(() => {
                btn.innerHTML = originalText;
                btn.classList.remove('bg-green-100', 'text-green-700');
            }, 2000);
        }
    </script>
</body>
</html>